<!DOCTYPE html>
<html lang="th">
<head>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" />
  <meta charset="UTF-8" />
  <title>DeployHub</title>
</head>
<body>
  <header>
    <h1 data-aos="fade-down">DeployHub</h1>
  </header>
  <main>
    <div id="content" data-aos="fade-up">
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
  </main>
  <footer>
    <p>¬© 2025 DeployHub. All rights reserved.</p>
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <script>
    const BACKEND_URL = "https://backend-f0ep.onrender.com";
    AOS.init();

    fetch("/me")
      .then(res => res.json())
      .then(data => {
        if (data.login) {
          document.getElementById("content").innerHTML = `
            <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${data.login}</p>
            <input type="file" webkitdirectory directory multiple id="folder" />
            <button onclick="upload()">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
            <p id="status"></p>
            <p><a href="/logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></p>
          `;
        } else {
          document.getElementById("content").innerHTML = `<a href="/login"><button>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ GitHub</button></a>`;
        }
      });

    async function upload() {
      const folderInput = document.getElementById("folder");
      const files = folderInput.files;
      const statusElement = document.getElementById("status");

      if (files.length === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå");

      statusElement.innerHTML = "üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå...";
      const formData = new FormData();
      for (let file of files) {
        formData.append("files", file, file.webkitRelativePath);
      }

      try {
        const res = await fetch("/upload", { method: "POST", body: formData });
        const data = await res.json();

        if (data.url) {
          statusElement.innerHTML = `‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö: <a href="${data.url}" target="_blank">${data.url}</a>`;
        } else {
          statusElement.innerHTML = "‚ùå ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå";
        }
      } catch (error) {
        statusElement.innerHTML = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î";
        console.error(error);
      }
    }
  </script>
</body>
</html>